{"files":[{"id":"32ff59b4-f342-47bb-b00d-a79f2aebf8e2","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Bangkok\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"a1667f90-ce0b-493e-818a-3e978b54e863","name":"Code","type":"server_js","source":"function doGet(request) {\n  var title \u003d request.parameter.title;\n  var name \u003d request.parameter.name;\n  var bd \u003d request.parameter.bd;\n  var tel \u003d request.parameter.tel;\n  var email \u003d request.parameter.email;\n  var ctzid \u003d request.parameter.ctzid;\n  var lineid \u003d request.parameter.lineid;\n  var insure \u003d \"ไม่มี\";\n  var type \u003d \"ไม่มี\";\n\n  // Validate inputs\n  if (!title || !name || !bd || !tel || !email || !ctzid || !lineid) {\n    return ContentService.createTextOutput(JSON.stringify({ status: \u0027error\u0027, message: \u0027Missing required fields\u0027 }))\n      .setMimeType(ContentService.MimeType.JSON);\n  }\n\n  // Access the Google Spreadsheet\n  var ss \u003d SpreadsheetApp.openByUrl(\"https://docs.google.com/spreadsheets/d/1oOWR1E8Kfmls65ZYMt4Avo4xDZ4lgZzUPgbr2_r_AyU/edit?usp\u003dsharing\");\n  var sheet \u003d ss.getSheetByName(\u0027Register\u0027);\n\n  // Check for duplicate entry based on ctzid (citizen ID)\n  var data \u003d sheet.getDataRange().getValues();\n  for (var i \u003d 1; i \u003c data.length; i++) { // Start from row 1 to skip header row\n    if (data[i][5] \u003d\u003d\u003d ctzid) { // Assuming ctzid is in the 6th column (index 5)\n      return ContentService.createTextOutput(JSON.stringify({ status: \u0027error\u0027, message: \u0027Duplicate citizen ID found\u0027 }))\n        .setMimeType(ContentService.MimeType.JSON);\n    }\n\n    // Check for duplicate lineid\n    if (data[i][6] \u003d\u003d\u003d lineid) { // Assuming lineid is in the 7th column (index 6)\n      return ContentService.createTextOutput(JSON.stringify({ status: \u0027error\u0027, message: \u0027Duplicate Line ID found\u0027 }))\n        .setMimeType(ContentService.MimeType.JSON);\n    }\n  }\n  var dateParts \u003d bd.split(\"-\");\n  var formattedBD \u003d dateParts[2] + \"-\" + dateParts[1] + \"-\" + dateParts[0]; // Rearrange date\n\n  // Append the new row to the spreadsheet\n  sheet.appendRow([title, name, formattedBD, tel, email, ctzid, lineid, insure, type]);\n\n  var result \u003d { status: \u0027success\u0027, message: \u0027Data stored successfully\u0027 };\n  var resultJSON \u003d JSON.stringify(result);\n  return ContentService.createTextOutput(resultJSON).setMimeType(ContentService.MimeType.JSON);\n}"}]}