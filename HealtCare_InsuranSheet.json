{"files":[{"id":"90cb2b56-aa5c-495c-8f2b-bb0c17984cfb","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Bangkok\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"901fd2f5-5d8f-4b76-a954-dc25138d8be8","name":"Code","type":"server_js","source":"function doGet(request) {\n  var ctzid \u003d request.parameter.ctzid;\n  var lineid \u003d request.parameter.lineid;\n  var insuran \u003d request.parameter.insuran;\n  var insurantype \u003d request.parameter.insurantype;\n\n  // Validate inputs\n  if (!ctzid || !lineid || !insuran || !insurantype) {\n    return ContentService.createTextOutput(JSON.stringify({ status: \u0027error\u0027, message: \u0027Missing required fields\u0027 }))\n      .setMimeType(ContentService.MimeType.JSON);\n  }\n\n  Logger.log(\"ctzid: \" + ctzid);\n  Logger.log(\"lineid: \" + lineid);\n  Logger.log(\"insuran: \" + insuran);\n  Logger.log(\"insurantype: \" + insurantype);\n\n  // Access the Google Spreadsheet\n  var ss \u003d SpreadsheetApp.openByUrl(\"https://docs.google.com/spreadsheets/d/1X8xIurq1VBxduSGaeW-s93Le5S2BPGWR_CTCEyS3nP4/edit?usp\u003dsharing\");\n  var sheet \u003d ss.getSheetByName(\u0027Register\u0027);\n\n  // Check for matching lineid and ctzid\n  var data \u003d sheet.getDataRange().getValues();\n  var found \u003d false;\n\n  for (var i \u003d 1; i \u003c data.length; i++) {\n    Logger.log(\"Checking row \" + (i + 1) + \": ctzid\u003d\" + data[i][5] + \", lineid\u003d\" + data[i][7]);\n\n    if (String(data[i][5]) \u003d\u003d\u003d String(ctzid) \u0026\u0026 data[i][7] \u003d\u003d\u003d lineid) { \n      // Update the data in the matched row\n      Logger.log(\"Match found at row \" + (i + 1));\n      sheet.getRange(i + 1, 9).setValue(insuran);\n      sheet.getRange(i + 1, 10).setValue(insurantype);\n      found \u003d true;\n      break;\n    }\n  }\n\n  if (found) {\n    var result \u003d { status: \u0027success\u0027, message: \u0027ซื้อประกันเรียบร้อยแล้ว ขอบคุณที่ซื้อประกันของเรา เราจะทำการเก็บเงินท่านในทุกสิ้นเดือน\u0027 };\n    Logger.log(\"Data updated successfully\");\n    return ContentService.createTextOutput(JSON.stringify(result)).setMimeType(ContentService.MimeType.JSON);\n  } else {\n    Logger.log(\"No matching data found\");\n    return ContentService.createTextOutput(JSON.stringify({ status: \u0027error\u0027, message: \u0027No matching data found\u0027 }))\n      .setMimeType(ContentService.MimeType.JSON);\n  }\n}"}]}